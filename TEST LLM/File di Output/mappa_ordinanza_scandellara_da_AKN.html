<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Mappa Ordinanza – Vie interessate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 75vh; width: 100vw; }
    .panel {
      box-sizing: border-box;
      padding: 1rem 1.25rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,.08);
      max-width: 960px;
      margin: 1rem;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .badge { display:inline-block; padding:.2rem .5rem; border-radius:6px; background:#eef2ff; border:1px solid #c7d2fe; color:#3730a3; font-weight:600; }
    .legend {
      background: white;
      padding: .5rem .75rem;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
      font-size: .9rem;
    }
    .legend-item { display: flex; align-items: center; gap: .5rem; margin:.25rem 0; }
    .swatch { width: 14px; height: 14px; border-radius: 3px; border:1px solid #d1d5db; }
    .chips { display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.25rem; }
    .chip { background:#f3f4f6; border:1px solid #e5e7eb; border-radius:999px; padding:.25rem .75rem; text-decoration:none; color:#111827; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="panel">
    <span class="badge">Vie oggetto dell'ordinanza</span>
    <div class="chips">
      <a class="chip" target="_blank" href="https://opendata.comune.bologna.it/explore/dataset/rifter_arcstra_li/table/?q=53550">Via Scandellara • CODVIA 53550</a>
      <a class="chip" target="_blank" href="https://opendata.comune.bologna.it/explore/dataset/rifter_arcstra_li/table/?q=22440">Via Ferrari • CODVIA 22440</a>
      <a class="chip" target="_blank" href="https://opendata.comune.bologna.it/explore/dataset/rifter_arcstra_li/table/?q=30850">Via Larga (corsello ovest) • CODVIA 30850</a>
    </div>
    <p style="margin-top:.75rem; color:#4b5563; font-size:.95rem;">
      Base cartografica: OpenStreetMap. Dati stradali: GeoJSON allegato (<em>rifter_arcstra_li</em>). Segmenti filtrati in base ai <strong>CODVIA</strong> indicati nel file XML AKN.
    </p>
    <div class="legend" id="legend"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // Inline filtered GeoJSON
    const GEO = {"type": "FeatureCollection", "features": [{"type": "Feature", "geometry": {"coordinates": [[11.386204141008603, 44.49630604503843], [11.38605410528049, 44.49630313153751], [11.385711016645443, 44.49631270614303], [11.38563934740944, 44.49631671569493], [11.385517825036382, 44.49633752154651], [11.385412146777904, 44.49636100303689], [11.3852187681263, 44.496420094652564], [11.38516006321606, 44.49643758894726], [11.385101141355522, 44.496450073309404], [11.38479390037319, 44.49650810422675], [11.384672934691807, 44.49653116619699], [11.384544583901615, 44.49654925084036], [11.38443609632667, 44.496559070183615], [11.384256602531186, 44.49657282123982], [11.384137943227302, 44.49657780230832], [11.383947985477791, 44.4965736852491], [11.383761130384995, 44.49656391248208], [11.383448377733862, 44.49654663128212]], "type": "LineString"}, "properties": {"codarco": 11962, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA FERNANDA PIVANO", "a": "VIA DELLO SPIRAGLIO", "cod_nodo1": 6969, "cod_nodo2": 18073, "data_istit": "1991-10-21", "lunghez": 223.0, "civico_min": 50, "esponente": null, "civico_mas": 54, "esponente0": "8", "civico_mi0": 11, "esponente1": "8", "civico_ma0": 37, "esponente2": "3", "geo_point_2d": {"lon": 11.384829039769246, "lat": 44.4964627583557}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.375745266114926, 44.49588836236857], [11.375577773118742, 44.496046746503104], [11.375552212691113, 44.49606465340676], [11.37547998931487, 44.49607918311666], [11.37544645278517, 44.49610014580528], [11.375368851198875, 44.496181379435285]], "type": "LineString"}, "properties": {"codarco": 8167, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA SCANDELLARA", "a": "VIA SCANDELLARA", "cod_nodo1": 16204, "cod_nodo2": 16205, "data_istit": "1998-06-02", "lunghez": 45.0, "civico_min": 12, "esponente": null, "civico_mas": 20, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.37555873039691, "lat": 44.49603882083875}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.376259049865606, 44.49612397881408], [11.376295793916235, 44.49616400460213], [11.376325881712582, 44.496200252821616], [11.376353407719714, 44.49624372041523], [11.376399917301322, 44.49633184170614], [11.376487450393453, 44.496549187176825], [11.376545352038113, 44.49670003526375]], "type": "LineString"}, "properties": {"codarco": 11959, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA FERNANDA PIVANO", "a": "VIA DEL TERRAPIENO", "cod_nodo1": 6293, "cod_nodo2": 18072, "data_istit": "2023-10-03", "lunghez": 68.0, "civico_min": 24, "esponente": null, "civico_mas": 28, "esponente0": null, "civico_mi0": 3, "esponente1": "2", "civico_ma0": 3, "esponente2": "2A", "geo_point_2d": {"lon": 11.37641966678447, "lat": 44.496401960609724}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.373666583450357, 44.4963631258803], [11.373581001820757, 44.49622241261448], [11.373567632042068, 44.49619546681624], [11.3735679195086, 44.49617218017068], [11.373593565641778, 44.49615203028743], [11.374731982469509, 44.49569144902907]], "type": "LineString"}, "properties": {"codarco": 11089, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": null, "a": null, "cod_nodo1": 15545, "cod_nodo2": 17668, "data_istit": "1997-11-18", "lunghez": 130.0, "civico_min": 2, "esponente": null, "civico_mas": 6, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.374068566600675, "lat": 44.49597833445533}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.389422839059852, 44.49659343583117], [11.392582977774174, 44.49690598200145], [11.392652437574869, 44.496926357359435], [11.392730070819688, 44.49696020025223], [11.392793365450558, 44.497016183901756], [11.392871331491733, 44.497150983601195], [11.39297303842763, 44.497307125806735], [11.393031382822658, 44.497428697821896], [11.393106068181314, 44.49757151540054]], "type": "LineString"}, "properties": {"codarco": 5229, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA DEL CARPENTIERE", "a": "GALLERIA VIALARGA", "cod_nodo1": 13217, "cod_nodo2": 13220, "data_istit": "1994-10-24", "lunghez": 342.0, "civico_min": 80, "esponente": null, "civico_mas": 88, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.391410672594718, "lat": 44.49684692028026}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.374731982469509, 44.49569144902907], [11.374793755188032, 44.49566643313973], [11.37511256073752, 44.495548321388085], [11.375154589144643, 44.4955373190105], [11.37519097115397, 44.49553656200542], [11.375229774920706, 44.49554588249939], [11.375285751541313, 44.495579458698195], [11.375563314286328, 44.495790825007894], [11.37565850680663, 44.49584384971566], [11.375745266114926, 44.49588836236857]], "type": "LineString"}, "properties": {"codarco": 8165, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA SCANDELLARA", "a": "VIA SCANDELLARA", "cod_nodo1": 15545, "cod_nodo2": 16204, "data_istit": "1998-06-02", "lunghez": 100.0, "civico_min": 8, "esponente": null, "civico_mas": 10, "esponente0": null, "civico_mi0": 1, "esponente1": null, "civico_ma0": 1, "esponente2": "D", "geo_point_2d": {"lon": 11.375251702549543, "lat": 44.495667604902614}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.387070755715934, 44.4963030864709], [11.387193246540654, 44.496610438639465]], "type": "LineString"}, "properties": {"codarco": 8170, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA SCANDELLARA", "a": "VIA SCANDELLARA", "cod_nodo1": 16206, "cod_nodo2": 16207, "data_istit": "1998-06-02", "lunghez": 36.0, "civico_min": 60, "esponente": null, "civico_mas": 62, "esponente0": "A", "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.387132001128293, "lat": 44.496456762555184}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.383448377733862, 44.49654663128212], [11.383166799530729, 44.496526717824715], [11.38239163528599, 44.49649168282457], [11.381009465797364, 44.49643831841124], [11.380310315304532, 44.49642003096632], [11.379286849670281, 44.49639884870284], [11.378962864340137, 44.49641303726839], [11.378597378272097, 44.49643388733892], [11.378502258718175, 44.49644614126276], [11.378408591155077, 44.49646595402724], [11.378256171567797, 44.496507723716334], [11.378133567169831, 44.49654962827908], [11.37798164623493, 44.49662748754831], [11.377809316669843, 44.49673116800432], [11.377673048248946, 44.496819080785556], [11.37752908059874, 44.496889643748844], [11.377411779666907, 44.49692837619819], [11.377303650949555, 44.49695016371212], [11.377194076571676, 44.49695928759543], [11.377096012220672, 44.49695791775377], [11.376983273234615, 44.49694829194801], [11.376886831855503, 44.496928054739705], [11.376799525031497, 44.49689736431768], [11.37672044469631, 44.496855231320716], [11.376615114965997, 44.49676731751499], [11.376545352038113, 44.49670003526375]], "type": "LineString"}, "properties": {"codarco": 11961, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA DEL TERRAPIENO", "a": "VIA FERNANDA PIVANO", "cod_nodo1": 6293, "cod_nodo2": 18073, "data_istit": "1991-10-21", "lunghez": 577.0, "civico_min": 34, "esponente": null, "civico_mas": 48, "esponente0": "5", "civico_mi0": 3, "esponente1": "5", "civico_ma0": 11, "esponente2": "3", "geo_point_2d": {"lon": 11.379927126690808, "lat": 44.4965476557878}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.387070755715934, 44.4963030864709], [11.386987228166033, 44.496306543615], [11.386726688383744, 44.49630685993139], [11.386401526523981, 44.496305105655814], [11.386204141008603, 44.49630604503843]], "type": "LineString"}, "properties": {"codarco": 8169, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA DELLO SPIRAGLIO", "a": "VIA SCANDELLARA", "cod_nodo1": 6969, "cod_nodo2": 16206, "data_istit": "1998-06-02", "lunghez": 69.0, "civico_min": 58, "esponente": null, "civico_mas": 58, "esponente0": "10", "civico_mi0": 41, "esponente1": null, "civico_ma0": 43, "esponente2": null, "geo_point_2d": {"lon": 11.386637479454988, "lat": 44.496305993495334}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.37574527904761, 44.495888371102], [11.37584676429137, 44.49594705334435], [11.375914562678545, 44.495973145111186], [11.375986407789162, 44.495999152608036], [11.376118728713482, 44.496045309377195], [11.376199565946372, 44.49608150053441], [11.376253986807313, 44.49611824153657], [11.376259049865606, 44.49612397881408]], "type": "LineString"}, "properties": {"codarco": 11960, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA SCANDELLARA", "a": "VIA FERNANDA PIVANO", "cod_nodo1": 16204, "cod_nodo2": 18072, "data_istit": "2023-10-03", "lunghez": 49.0, "civico_min": 22, "esponente": null, "civico_mas": 22, "esponente0": null, "civico_mi0": 3, "esponente1": null, "civico_ma0": 3, "esponente2": "1", "geo_point_2d": {"lon": 11.376003432950876, "lat": 44.49600459628246}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.389422839059852, 44.49659343583117], [11.38914786321045, 44.496548920940704], [11.388772572177706, 44.49646515583424], [11.388403987699403, 44.49639097195102], [11.388122648066313, 44.496351359101304], [11.387827489628348, 44.49631061221402], [11.387601251953456, 44.496284483623725], [11.387550893310813, 44.496278100792466]], "type": "LineString"}, "properties": {"codarco": 9398, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA BENVENUTO CELLINI", "a": "VIA DEL CARPENTIERE", "cod_nodo1": 13217, "cod_nodo2": 17031, "data_istit": "2004-07-05", "lunghez": 153.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.388489181148113, "lat": 44.49642173000749}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.387550893310813, 44.496278100792466], [11.387459626745205, 44.49627715584282], [11.387223888735619, 44.496292826109034], [11.387070755715934, 44.4963030864709]], "type": "LineString"}, "properties": {"codarco": 9399, "codvia": 53550, "nomevia": "VIA SCANDELLARA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA SCANDELLARA", "a": "VIA BENVENUTO CELLINI", "cod_nodo1": 17031, "cod_nodo2": 16206, "data_istit": "2004-07-05", "lunghez": 38.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": 45, "esponente1": null, "civico_ma0": 45, "esponente2": null, "geo_point_2d": {"lon": 11.38731074323652, "lat": 44.49628773079322}, "codice_ans": 760316}}, {"type": "Feature", "geometry": {"coordinates": [[11.391588486914833, 44.504185675811044], [11.391396083997689, 44.5038357798308]], "type": "LineString"}, "properties": {"codarco": 5287, "codvia": 22440, "nomevia": "VIA ENZO FERRARI", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA ENZO FERRARI", "a": "VIA ENZO FERRARI", "cod_nodo1": 13257, "cod_nodo2": 13258, "data_istit": "1995-05-18", "lunghez": 42.0, "civico_min": 30, "esponente": null, "civico_mas": 30, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.391492285456263, "lat": 44.504010727820926}, "codice_ans": 759497}}, {"type": "Feature", "geometry": {"coordinates": [[11.396745585296966, 44.50247991638501], [11.39533540790542, 44.50293340220388], [11.395260703026867, 44.502950391187], [11.395195797933903, 44.502944055902105], [11.395154165125023, 44.502914086672895], [11.395087767050294, 44.50280559451169], [11.395054203412972, 44.50277545593868], [11.395000056851496, 44.50276888580807], [11.394941174336985, 44.50277782741025], [11.392416412989805, 44.503568602812145], [11.392370377237036, 44.50359732255358], [11.392344798629784, 44.50363164526071], [11.392336518622235, 44.503676462518854], [11.392369018025544, 44.503728878537224], [11.392483783023918, 44.503937637426574], [11.392468272936261, 44.50397054278896], [11.3924505360311, 44.503990225037974], [11.392424130993962, 44.50400404823388], [11.39174004924972, 44.50422232765079], [11.39169104599594, 44.50421973535036], [11.391588486914833, 44.504185675811044]], "type": "LineString"}, "properties": {"codarco": 5285, "codvia": 22440, "nomevia": "VIA ENZO FERRARI", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA ENZO FERRARI", "cod_nodo1": 13096, "cod_nodo2": 13257, "data_istit": "1995-05-18", "lunghez": 512.0, "civico_min": 6, "esponente": null, "civico_mas": 28, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.394020039389938, "lat": 44.50322739591099}, "codice_ans": 759497}}, {"type": "Feature", "geometry": {"coordinates": [[11.391588486914833, 44.504185675811044], [11.390932809611275, 44.50411247336435], [11.390343727385204, 44.50406596065221], [11.390093162094788, 44.50404278618004], [11.390057166609115, 44.504035275494566], [11.390033113293162, 44.50402294145489], [11.390012061024377, 44.50400185709962], [11.389881155883531, 44.50378333275222], [11.389875385675387, 44.50375819235619], [11.389878647506055, 44.50372843360083], [11.38990318808999, 44.50369760816958], [11.3902140882853, 44.50332367684669], [11.390591255407914, 44.5028356717468], [11.390627181869439, 44.50281259298551], [11.390666239006915, 44.502796551672915], [11.390750539156562, 44.502768084520085]], "type": "LineString"}, "properties": {"codarco": 5286, "codvia": 22440, "nomevia": "VIA ENZO FERRARI", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA ENZO FERRARI", "a": "VIA EDOARDO WEBER", "cod_nodo1": 13257, "cod_nodo2": 13256, "data_istit": "1995-05-18", "lunghez": 290.0, "civico_min": 38, "esponente": null, "civico_mas": 44, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.390507955557714, "lat": 44.50372087320559}, "codice_ans": 759497}}, {"type": "Feature", "geometry": {"coordinates": [[11.402597759282687, 44.51182378653067], [11.402182855901025, 44.511134811562044], [11.402103231205452, 44.51098301160062], [11.402040538665345, 44.51083084627648], [11.401820761703378, 44.510290221984114], [11.401717581288977, 44.51011469148557], [11.401308051742463, 44.50948919414839], [11.401238073983198, 44.5093892794058]], "type": "LineString"}, "properties": {"codarco": 4777, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA PIOPPE", "a": "VIA LINO SIGHINOLFI", "cod_nodo1": 10825, "cod_nodo2": 13844, "data_istit": "1991-10-21", "lunghez": 292.0, "civico_min": 46, "esponente": null, "civico_mas": 52, "esponente0": null, "civico_mi0": 55, "esponente1": null, "civico_ma0": 55, "esponente2": null, "geo_point_2d": {"lon": 11.401932027779356, "lat": 44.5105979029321}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.395683244128065, 44.50084746361968], [11.39491234804137, 44.499549462588], [11.394899442188802, 44.49951813432938], [11.394871409807571, 44.49938191036739]], "type": "LineString"}, "properties": {"codarco": 10207, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA CERODOLO", "cod_nodo1": 10849, "cod_nodo2": 17317, "data_istit": "2007-04-10", "lunghez": 176.0, "civico_min": 20, "esponente": null, "civico_mas": 28, "esponente0": "2", "civico_mi0": 29, "esponente1": null, "civico_ma0": 31, "esponente2": null, "geo_point_2d": {"lon": 11.395255819832682, "lat": 44.500123216197096}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.394758477937868, 44.499226482533246], [11.394693101864982, 44.49918980916561], [11.394627691821695, 44.49912466133701], [11.394583032892466, 44.49905573821329], [11.394123319232056, 44.49830356516468]], "type": "LineString"}, "properties": {"codarco": 10217, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA LARGA", "cod_nodo1": 17318, "cod_nodo2": 17321, "data_istit": "2007-04-10", "lunghez": 115.0, "civico_min": 12, "esponente": "5", "civico_mas": 18, "esponente0": "5", "civico_mi0": 27, "esponente1": null, "civico_ma0": 27, "esponente2": "6", "geo_point_2d": {"lon": 11.394421265076904, "lat": 44.49878347929709}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.394968398930214, 44.49926908985096], [11.394972578906804, 44.49928761046796], [11.39497162053288, 44.49930597781703], [11.394968231138275, 44.49931535758861], [11.394962905598442, 44.499327217678825], [11.39495481042878, 44.499338406669146], [11.39494959395212, 44.499344637863054], [11.394938050118116, 44.49935516099632], [11.394923377425323, 44.49936453442593], [11.394908975944071, 44.499371930600326], [11.394886018754038, 44.49937927220563], [11.394871409439162, 44.499381901372544]], "type": "LineString"}, "properties": {"codarco": 10222, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA DEL CARROZZAIO", "a": "VIA LARGA", "cod_nodo1": 17317, "cod_nodo2": 17319, "data_istit": "2007-04-10", "lunghez": 16.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.394938462433103, "lat": 44.4993390024005}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.392927477411833, 44.49641874349193], [11.393048287760623, 44.496503850974605], [11.39319640756801, 44.49668705401153], [11.393306375011814, 44.49686923824595], [11.393370880620614, 44.49699935940006], [11.39362902968164, 44.497530238942915]], "type": "LineString"}, "properties": {"codarco": 11732, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": null, "a": null, "cod_nodo1": 17320, "cod_nodo2": 17670, "data_istit": "2015-09-29", "lunghez": 137.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": 17, "esponente1": "A", "civico_ma0": 23, "esponente2": "5", "geo_point_2d": {"lon": 11.393319017244217, "lat": 44.49694341659466}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.396117434421303, 44.501521573404226], [11.396188924752321, 44.50151919948744], [11.396284450748011, 44.50154007874254], [11.39634535766098, 44.5015900787791], [11.397001257672528, 44.50252435910428], [11.39733183645717, 44.50304758709766], [11.39763924155748, 44.50352552278802], [11.398004185615138, 44.504088583481746]], "type": "LineString"}, "properties": {"codarco": 11755, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA LARGA", "cod_nodo1": 17964, "cod_nodo2": 17965, "data_istit": "2021-05-20", "lunghez": 328.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": 35, "esponente1": null, "civico_ma0": 37, "esponente2": "T", "geo_point_2d": {"lon": 11.397113376349953, "lat": 44.50273305018157}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.398004185615138, 44.504088583481746], [11.398349678117885, 44.50454437196898]], "type": "LineString"}, "properties": {"codarco": 11756, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA LARGA", "cod_nodo1": 17965, "cod_nodo2": 17966, "data_istit": "2021-05-20", "lunghez": 58.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": 39, "esponente1": null, "civico_ma0": 41, "esponente2": null, "geo_point_2d": {"lon": 11.398176931866512, "lat": 44.50431647772537}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.401238073983198, 44.5093892794058], [11.400191140592318, 44.50925758808067]], "type": "LineString"}, "properties": {"codarco": 3712, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA ALFREDO PANZINI", "a": "VIA PIOPPE", "cod_nodo1": 15463, "cod_nodo2": 10825, "data_istit": "1991-10-21", "lunghez": 85.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.400714607287757, "lat": 44.50932343374323}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.396461153526817, 44.50829484638141], [11.397023380917657, 44.50836608122435], [11.39737156283279, 44.50842134604882], [11.397650147517155, 44.50847134676612], [11.397785508433937, 44.50850370351933], [11.39807616620526, 44.508599578706196], [11.398382818334916, 44.50871332027125], [11.399146824801116, 44.50899154995493], [11.399441900786762, 44.50909135293332], [11.399553432219061, 44.509125756918976], [11.399690629547349, 44.50916171883806], [11.399859993828285, 44.50919578897975], [11.400191140592318, 44.50925758808067]], "type": "LineString"}, "properties": {"codarco": 3713, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA DEL PILASTRO", "a": "VIA ALFREDO PANZINI", "cod_nodo1": 15466, "cod_nodo2": 15463, "data_istit": "1991-10-21", "lunghez": 317.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.398335997475899, "lat": 44.50873171131908}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.402597759282687, 44.51182378653067], [11.403050342954655, 44.51253268155741], [11.403118312802366, 44.51263530216407]], "type": "LineString"}, "properties": {"codarco": 3719, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LINO SIGHINOLFI", "a": "VIA GIOVAN BATTISTA MARTINETTI", "cod_nodo1": 13844, "cod_nodo2": 10831, "data_istit": "1991-10-21", "lunghez": 99.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.40285727995114, "lat": 44.512230036050966}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.397292923223938, 44.50410983387629], [11.397288414484027, 44.50436555640431], [11.39726704712255, 44.50452920363932], [11.397254364457766, 44.50467241271012]], "type": "LineString"}, "properties": {"codarco": 11709, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": null, "a": null, "cod_nodo1": 16553, "cod_nodo2": 17940, "data_istit": "1991-10-21", "lunghez": 63.0, "civico_min": 38, "esponente": "5", "civico_mas": 38, "esponente0": "5", "civico_mi0": 45, "esponente1": null, "civico_ma0": 45, "esponente2": "A", "geo_point_2d": {"lon": 11.39727925654738, "lat": 44.50439145907871}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.395727817855018, 44.50091608199323], [11.395683243759512, 44.50084745462485]], "type": "LineString"}, "properties": {"codarco": 4108, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA CERODOLO", "a": "VIA LICINIO CAPPELLI", "cod_nodo1": 10849, "cod_nodo2": 13095, "data_istit": "1991-10-21", "lunghez": 8.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.395705530807266, "lat": 44.50088176830904}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.396745585296966, 44.50247991638501], [11.39710374822107, 44.503028610299744], [11.39716168443856, 44.50315796687823], [11.397220739161357, 44.50331490180412], [11.397258586867206, 44.50346727663746], [11.39728382325817, 44.50365507132752], [11.397293680587113, 44.50406664166708], [11.397292923223938, 44.50410983387629]], "type": "LineString"}, "properties": {"codarco": 11708, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": null, "a": null, "cod_nodo1": 13096, "cod_nodo2": 17940, "data_istit": "1991-10-21", "lunghez": 189.0, "civico_min": 38, "esponente": null, "civico_mas": 38, "esponente0": "4", "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.3971257473713, "lat": 44.50326103698459}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.394123319232056, 44.49830356516468], [11.393812600885324, 44.49787662563284]], "type": "LineString"}, "properties": {"codarco": 10218, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA LARGA", "cod_nodo1": 13845, "cod_nodo2": 17321, "data_istit": "2007-04-10", "lunghez": 53.0, "civico_min": 10, "esponente": null, "civico_mas": 12, "esponente0": "4", "civico_mi0": 25, "esponente1": null, "civico_ma0": 25, "esponente2": null, "geo_point_2d": {"lon": 11.39396796005869, "lat": 44.498090095398766}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.394871409439162, 44.499381901372544], [11.394846866828495, 44.49938400972744], [11.394829375192376, 44.49938290927648], [11.394810792945096, 44.499380364283994], [11.394791761216906, 44.499375136949254], [11.394777869366866, 44.4993697927788], [11.394765285111934, 44.4993632058274], [11.394750509325377, 44.49935347794003], [11.394741612494949, 44.49934509413673], [11.394734085560039, 44.499336681594016], [11.394727918573627, 44.49932799745148], [11.394723810090431, 44.499319513193434], [11.394721880571772, 44.499314170134085], [11.394719471367427, 44.4993054071579], [11.394718758819113, 44.499296608588196], [11.394719338476284, 44.4992855772797], [11.394721245249405, 44.499273779919235], [11.394724662636463, 44.4992653898506], [11.39472938949828, 44.49925549588899], [11.394734578404888, 44.499248284003095], [11.394741102118852, 44.49924080104488], [11.394758477937868, 44.499226482533246]], "type": "LineString"}, "properties": {"codarco": 10223, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA LARGA", "cod_nodo1": 17317, "cod_nodo2": 17318, "data_istit": "2007-04-10", "lunghez": 26.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.39476697618499, "lat": 44.499328428126766}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.394758477937868, 44.499226482533246], [11.394779306153175, 44.499215071442094], [11.394789002739316, 44.49921104192267], [11.394802003833243, 44.4992075372459], [11.39481379763811, 44.49920434597818], [11.394827297829993, 44.49920289241674], [11.394842077967963, 44.49920228525035], [11.394858101496434, 44.4992022461657], [11.394876696256288, 44.49920479088808], [11.394890803494004, 44.49920802392592], [11.394907068376137, 44.49921357036801], [11.3949221369433, 44.499220312241285], [11.394933522738532, 44.49922742846381], [11.394950112576538, 44.499240908350544], [11.394963151130757, 44.49925827983395], [11.394968398930214, 44.49926908985096]], "type": "LineString"}, "properties": {"codarco": 10226, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA DEL CARROZZAIO", "cod_nodo1": 17319, "cod_nodo2": 17318, "data_istit": "2007-04-10", "lunghez": 21.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.394870627842032, "lat": 44.499218637560176}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.396117434421303, 44.501521573404226], [11.395906221112316, 44.501199312531384], [11.395727817855018, 44.50091608199323]], "type": "LineString"}, "properties": {"codarco": 11754, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": null, "a": null, "cod_nodo1": 13095, "cod_nodo2": 17964, "data_istit": "1991-10-21", "lunghez": 74.0, "civico_min": 30, "esponente": null, "civico_mas": 32, "esponente0": "3", "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.395921265110077, "lat": 44.501219702261295}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.398004198183951, 44.50408858321771], [11.397292923223938, 44.50410983387629]], "type": "LineString"}, "properties": {"codarco": 11757, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA LARGA", "cod_nodo1": 17965, "cod_nodo2": 17940, "data_istit": "2021-05-20", "lunghez": 57.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.397648560703946, "lat": 44.504099208547004}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.396461153526817, 44.50829484638141], [11.396524906096108, 44.50799706263967], [11.396673134067287, 44.50741572509332], [11.396844542838659, 44.50673217162541]], "type": "LineString"}, "properties": {"codarco": 7740, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "VIA DEL PILASTRO", "cod_nodo1": 15466, "cod_nodo2": 15547, "data_istit": "1997-11-18", "lunghez": 176.0, "civico_min": 40, "esponente": null, "civico_mas": 44, "esponente0": null, "civico_mi0": 49, "esponente1": null, "civico_ma0": 49, "esponente2": null, "geo_point_2d": {"lon": 11.396648951751546, "lat": 44.507512609541244}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.396745585296966, 44.50247991638501], [11.396117434421303, 44.501521573404226]], "type": "LineString"}, "properties": {"codarco": 11753, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": null, "a": null, "cod_nodo1": 13096, "cod_nodo2": 17964, "data_istit": "1991-10-21", "lunghez": 118.0, "civico_min": 34, "esponente": null, "civico_mas": 36, "esponente0": "2E", "civico_mi0": 33, "esponente1": null, "civico_ma0": 33, "esponente2": null, "geo_point_2d": {"lon": 11.396431509859134, "lat": 44.502000744894616}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.391512196322953, 44.49407773626342], [11.391664862671067, 44.494156488215516], [11.391727061133293, 44.49425343017615], [11.392090152433308, 44.49488725571597], [11.392762504760185, 44.49598685508755], [11.39278864222032, 44.49610429497382], [11.392797422596251, 44.49614428041816], [11.392821907012394, 44.4962652749519]], "type": "LineString"}, "properties": {"codarco": 10568, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "ROTONDA ROMANO PARADISI", "a": "ROTONDA DELLA LEONA", "cod_nodo1": 7012, "cod_nodo2": 17443, "data_istit": "2008-06-17", "lunghez": 268.0, "civico_min": 4, "esponente": null, "civico_mas": 8, "esponente0": "2A", "civico_mi0": 7, "esponente1": null, "civico_ma0": 17, "esponente2": "1B", "geo_point_2d": {"lon": 11.392232632497256, "lat": 44.49512611875481}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.394123319232056, 44.49830356516468], [11.393941390990255, 44.498157460810354], [11.393863192806005, 44.4981264664081], [11.393785579078664, 44.498109746780116], [11.39369983626527, 44.498103388476935], [11.393516456647388, 44.4981135355364]], "type": "LineString"}, "properties": {"codarco": 11097, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LARGA", "a": "ROTONDA ELENA LUCREZIA CORNER PISCOPIA", "cod_nodo1": 16097, "cod_nodo2": 17321, "data_istit": "2015-09-29", "lunghez": 57.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.39383690264828, "lat": 44.498156324387374}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.396844542838659, 44.50673217162541], [11.396923334829573, 44.50640884662792], [11.397119547421928, 44.505659062108265], [11.397213080783798, 44.50523757843054], [11.39723911829608, 44.5051092762404]], "type": "LineString"}, "properties": {"codarco": 7741, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "ROTONDA GIUSEPPE MODONESI", "a": "VIA LARGA", "cod_nodo1": 15547, "cod_nodo2": 16551, "data_istit": "1997-11-18", "lunghez": 183.0, "civico_min": null, "esponente": null, "civico_mas": null, "esponente0": null, "civico_mi0": 45, "esponente1": "5", "civico_ma0": 47, "esponente2": "D", "geo_point_2d": {"lon": 11.397047530379734, "lat": 44.50592204629982}, "codice_ans": 759859}}, {"type": "Feature", "geometry": {"coordinates": [[11.402597759282687, 44.51182378653067], [11.401930131415138, 44.51265095638852], [11.401862750274878, 44.512704661032615], [11.401784526548829, 44.51274863694846], [11.400368989359608, 44.51324081920942], [11.400287015231202, 44.513324025063355]], "type": "LineString"}, "properties": {"codarco": 6077, "codvia": 30850, "nomevia": "VIA LARGA", "numquart": 14, "nomequart": "San Donato - San Vitale", "da": "VIA LINO SIGHINOLFI", "a": "VIA LARGA", "cod_nodo1": 13844, "cod_nodo2": 13841, "data_istit": "1997-05-15", "lunghez": 259.0, "civico_min": 52, "esponente": "11", "civico_mas": 54, "esponente0": "16", "civico_mi0": null, "esponente1": null, "civico_ma0": null, "esponente2": null, "geo_point_2d": {"lon": 11.40153646160962, "lat": 44.51270645987144}, "codice_ans": 759859}}]};
    const codviaStyles = {
      53550: { color: "#1d4ed8", weight: 5 },
      22440: { color: "#059669", weight: 5 },
      30850: { color: "#b45309", weight: 5 }
    };
    const codviaLabels = {
      53550: "Via Scandellara",
      22440: "Via Ferrari",
      30850: "Via Larga (corsello ovest)"
    };

    const map = L.map('map');
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Create layer groups per CODVIA
    const groups = {};
    Object.keys(codviaStyles).forEach(k => groups[k] = L.layerGroup().addTo(map));
    const allBounds = [];

    GEO.features.forEach(f => {
      const cv = f.properties.codvia;
      const style = codviaStyles[cv] || { color: '#111827', weight: 4 };
      const layer = L.geoJSON(f, {
        style: style,
        onEachFeature: (feat, lyr) => {
          const p = feat.properties || {};
          const name = p.nomevia || codviaLabels[cv] || 'Tratto stradale';
          const from = p.da || '';
          const to = p.a || '';
          const content = `<strong>${name}</strong><br>CODVIA: ${cv}` +
                          (from || to ? `<br><small>${from} → ${to}</small>` : '');
          lyr.bindPopup(content);
        }
      });
      layer.addTo(groups[cv]);
      try { allBounds.push(layer.getBounds()); } catch (e) {}
    });

    // Fit bounds to all segments
    if (allBounds.length > 0) {
      let b = allBounds[0];
      for (let i = 1; i < allBounds.length; i++) {
        b = b.extend(allBounds[i]);
      }
      map.fitBounds(b.pad(0.1));
    } else {
      map.setView([44.4949, 11.3426], 12); // fallback Bologna centro
    }

    // Build legend
    const legend = document.getElementById('legend');
    function legendItem(color, label, count) {
      return `<div class="legend-item"><span class="swatch" style="background:${color}"></span><span>${label}</span><span style="margin-left:.5rem;color:#6b7280">(${count} segmenti)</span></div>`;
    }
    const counts = {
      53550: 12,
      22440: 3,
      30850: 24
    };
    legend.innerHTML = [
      legendItem(codviaStyles[53550].color, codviaLabels[53550], counts[53550]),
      legendItem(codviaStyles[22440].color, codviaLabels[22440], counts[22440]),
      legendItem(codviaStyles[30850].color, codviaLabels[30850], counts[30850])
    ].join("");
  </script>
</body>
</html>
